# 태스크 태그 및 색상 기능 추가 가이드

## 구현 완료 사항

### 1. 데이터베이스 스키마
- `database_update_tags.sql` 파일 생성
- 태그 테이블 (팀/개인 구분)
- 태스크-태그 연결 테이블
- 태스크에 색상(color) 컬럼 추가

### 2. 백엔드 구현
- `/src/lib/tag.ts`: 태그 관리 라이브러리
  - 태그 생성, 조회, 수정, 삭제
  - 태스크에 태그 추가/제거
  
- `/src/app/api/tags/route.ts`: 태그 API
  - GET: 팀/개인 태그 목록 조회
  - POST: 새 태그 생성
  
- `/src/app/api/tags/[id]/route.ts`: 개별 태그 API
  - PATCH: 태그 수정
  - DELETE: 태그 삭제

- `/src/lib/task.ts` 업데이트:
  - `createTask`: 색상 및 태그 지원
  - `updateTask`: 색상 및 태그 업데이트
  - 트랜잭션 처리로 데이터 무결성 보장

- `/src/app/api/tasks/route.ts` 업데이트:
  - POST, PATCH 엔드포인트에 color, tag_ids 필드 추가

### 3. 프론트엔드 구현
- `TaskModal` 컴포넌트 대폭 개선:
  - **색상 선택**: 8가지 색상 옵션 제공
  - **태그 선택**: 
    - 팀 태스크: 팀 태그 표시
    - 개인 태스크: 개인 태그 표시
  - **태그 생성**: 모달 내에서 새 태그 즉시 생성 가능
  - 선택된 태그 시각적 표시 (링 효과)

- **모든 TaskModal 사용처 업데이트**:
  - `TasksDemo.tsx`
  - `TaskList.tsx`
  - `CalendarDemo.tsx`
  - 모든 컴포넌트에 `workspaceType`과 `ownerId` props 전달

## 사용 방법

### 1. 데이터베이스 마이그레이션 (필수!)
```bash
# MySQL에 접속하여 실행
mysql -u [사용자명] -p [데이터베이스명] < database_update_tags.sql
```

⚠️ **중요**: 데이터베이스 마이그레이션을 실행하지 않으면 태그 기능이 작동하지 않습니다!

### 2. 태그 등록 방법

1. **태스크 생성/수정 모달 열기**
2. **색상 선택 섹션**: 8가지 색상 중 하나를 클릭하여 태스크 색상 선택
3. **태그 섹션**:
   - 기존 태그가 있으면 클릭하여 선택/해제
   - 선택된 태그는 링 효과로 표시됨
4. **새 태그 추가**:
   - "새 태그 추가" 버튼 클릭
   - 태그 이름 입력
   - 태그 색상 선택 (8가지 중 선택)
   - "생성" 버튼 클릭
   - 생성된 태그가 즉시 목록에 나타남
5. 태스크 저장

### 3. API 사용 예시

#### 태그 조회
```typescript
GET /api/tags?owner_type=team&owner_id=1
// 응답: { tags: [...] }
```

#### 태그 생성
```typescript
POST /api/tags
Body: {
  name: "긴급",
  color: "#EF4444",
  owner_type: "team",
  owner_id: 1
}
```

#### 태스크 생성 (태그 포함)
```typescript
POST /api/tasks
Body: {
  title: "새 태스크",
  start_time: "2026-02-10T09:00",
  end_time: "2026-02-10T18:00",
  content: "내용",
  workspace_id: 1,
  color: "#3B82F6",
  tag_ids: [1, 2, 3]
}
```

## 주요 특징

### 태그 시스템
- **팀 태그**: 팀 워크스페이스에서 사용, 팀원 모두 공유
- **개인 태그**: 개인 워크스페이스에서 사용, 개인만 사용
- 태그마다 고유한 색상 지정 가능
- 동일한 팀/개인 내에서 태그명 중복 방지

### 색상 선택
- 8가지 미리 정의된 색상 팔레트
- 시각적 피드백으로 선택 상태 확인
- 태스크별로 고유한 색상 지정 가능

### 사용자 경험
- 태그 즉시 생성: 모달을 닫지 않고 바로 태그 생성
- 시각적 구분: 선택된 태그는 링 효과로 표시
- 로딩 상태: 태그 불러오는 동안 로딩 메시지 표시

## 데이터베이스 구조

### tags 테이블
```sql
- tag_id: 태그 고유 ID
- name: 태그 이름
- color: 태그 색상 (hex)
- owner_type: 'team' 또는 'personal'
- owner_id: team_id 또는 member_id
- created_at: 생성일시
- created_by: 생성자 member_id
```

### task_tags 테이블 (연결 테이블)
```sql
- task_tag_id: 연결 고유 ID
- task_id: 태스크 ID
- tag_id: 태그 ID
- created_at: 생성일시
```

### tasks 테이블 (추가된 컬럼)
```sql
- color: 태스크 색상 (hex), 기본값 '#3B82F6'
```

## 문제 해결

### 태그가 표시되지 않는 경우
1. 데이터베이스 마이그레이션을 실행했는지 확인
2. `workspaceType`과 `ownerId`가 올바르게 전달되는지 확인
3. 브라우저 콘솔에서 에러 메시지 확인

### 태그 생성이 안 되는 경우
1. 같은 이름의 태그가 이미 있는지 확인
2. API 응답 확인 (409 Conflict 에러 = 중복)
3. 워크스페이스가 올바르게 선택되어 있는지 확인

## 다음 단계 (선택 사항)

1. **태그 필터링**: 태스크 목록에서 태그로 필터링
2. **태그 통계**: 가장 많이 사용된 태그 표시
3. **태그 관리 페이지**: 태그 일괄 편집/삭제
4. **캘린더 뷰**: 태스크 색상을 캘린더에 표시
5. **태그 자동완성**: 기존 태그명 자동 제안

## 주의사항

- `workspaceType`과 `ownerId`를 정확히 전달해야 올바른 태그가 표시됩니다
- 태그 삭제 시 해당 태그를 사용하는 태스크에서 자동으로 제거됩니다 (ON DELETE CASCADE)
- 트랜잭션 처리로 태스크와 태그가 항상 일관성을 유지합니다
