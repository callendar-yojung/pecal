import { createContext, useContext, useMemo, useState } from 'react';

type Locale = 'ko' | 'en';

type I18nContextValue = {
  locale: Locale;
  setLocale: (locale: Locale) => void;
  t: (key: string, params?: Record<string, string | number>) => string;
};

const dict: Record<Locale, Record<string, string>> = {
  ko: {
    loading: '앱 준비 중...',
    loginTitle: 'Pecal Mobile',
    loginSubtitle: '웹/데스크톱과 동일한 OAuth 로그인',
    loginKakao: '카카오 로그인',
    loginGoogle: '구글 로그인',
    personal: '개인',
    today: 'Today',
    notifications: '알림',
    appName: 'Pecal',
    themeLight: '라이트',
    themeBlack: '블랙',
    logout: '로그아웃',
    createTeam: '팀 만들기',
    tabOverview: '개요',
    tabTasks: '일정',
    tabCalendar: '캘린더',
    tabMemo: '메모',
    tabFiles: '파일',
    noWorkspace: '워크스페이스를 선택하세요.',
    commonOverview: '개요',
    commonTasks: '일정',
    commonMemo: '메모',
    commonFiles: '파일',
    commonTodaySummary: '오늘 요약',
    commonLoading: '불러오는 중...',
    commonNoData: '데이터가 없습니다.',
    commonSave: '저장',
    commonCreate: '생성',
    commonCancel: '취소',
    commonClose: '닫기',
    workspacePersonal: '개인',
    workspaceCreateTeam: '+ 팀 만들기',
    teamCreateTitle: '팀 만들기',
    teamName: '팀 이름',
    teamDescription: '팀 설명(선택)',
    teamCreating: '생성 중...',
    teamNext: '다음',
    teamPlanTitle: '플랜 선택',
    teamFreePlan: '무료 플랜',
    teamFreePlanDesc: '기본 팀 기능 사용',
    teamPaidPlan: '유료 플랜',
    teamPaidPlanDesc: '결제/고급 기능 사용',
    overviewDateLabel: '오늘',
    overviewCardTasks: '진행중 일정',
    overviewCardMemos: '메모',
    overviewCardFiles: '파일',
    overviewCardUnread: '읽지 않은 알림',
    overviewSummaryTasks: '일정 상태',
    overviewSummaryMemos: '메모 상태',
    overviewSummaryTasksDesc: '진행할 작업 {count}개',
    overviewSummaryMemosDesc: '정리할 메모 {count}개',
    tasksHeaderSub: 'Schedule',
    tasksTotal: '전체 일정',
    tasksTodo: '진행 필요',
    tasksCreateTitle: '일정 등록',
    tasksTitlePlaceholder: '일정 제목',
    tasksStartPlaceholder: '시작시간',
    tasksEndPlaceholder: '종료시간',
    tasksStatusTodo: '예정',
    tasksStatusProgress: '진행중',
    tasksStatusDone: '완료',
    tasksEmpty: '등록된 일정이 없습니다.',
    memoHeaderSub: 'Memo',
    memoCreateTitle: '새 메모',
    memoTitlePlaceholder: '메모 제목',
    memoContentPlaceholder: '메모 내용',
    memoCreate: '메모 생성',
    memoEmpty: '등록된 메모가 없습니다.',
    memoNoContent: '내용 없음',
    filesHeaderSub: 'Files',
    filesFilterAll: '전체',
    filesFilterImage: '이미지',
    filesFilterDocument: '문서',
    filesFilterOther: '기타',
    filesEmpty: '등록된 파일이 없습니다.',
    calendarMonthSchedule: '{month} 일정 ({count}개)',
    calendarEmpty: '이 달의 일정이 없습니다',
    queuePending: '동기화 대기 {count}건',
    queueRetry: '지금 재전송',
    queueFlushing: '재전송 중...',
  },
  en: {
    loading: 'Preparing app...',
    loginTitle: 'Pecal Mobile',
    loginSubtitle: 'OAuth flow shared with web/desktop',
    loginKakao: 'Kakao Login',
    loginGoogle: 'Google Login',
    personal: 'Personal',
    today: 'Today',
    notifications: 'Notifications',
    appName: 'Pecal',
    themeLight: 'Light',
    themeBlack: 'Black',
    logout: 'Logout',
    createTeam: 'Create Team',
    tabOverview: 'Overview',
    tabTasks: 'Schedule',
    tabCalendar: 'Calendar',
    tabMemo: 'Memo',
    tabFiles: 'Files',
    noWorkspace: 'Select a workspace.',
    commonOverview: 'Overview',
    commonTasks: 'Schedule',
    commonMemo: 'Memo',
    commonFiles: 'Files',
    commonTodaySummary: 'Today Summary',
    commonLoading: 'Loading...',
    commonNoData: 'No data.',
    commonSave: 'Save',
    commonCreate: 'Create',
    commonCancel: 'Cancel',
    commonClose: 'Close',
    workspacePersonal: 'Personal',
    workspaceCreateTeam: '+ Create Team',
    teamCreateTitle: 'Create Team',
    teamName: 'Team Name',
    teamDescription: 'Team Description (optional)',
    teamCreating: 'Creating...',
    teamNext: 'Next',
    teamPlanTitle: 'Choose Plan',
    teamFreePlan: 'Free Plan',
    teamFreePlanDesc: 'Use basic team features',
    teamPaidPlan: 'Paid Plan',
    teamPaidPlanDesc: 'Use billing and advanced features',
    overviewDateLabel: 'Today',
    overviewCardTasks: 'Active Tasks',
    overviewCardMemos: 'Memos',
    overviewCardFiles: 'Files',
    overviewCardUnread: 'Unread Alerts',
    overviewSummaryTasks: 'Task Status',
    overviewSummaryMemos: 'Memo Status',
    overviewSummaryTasksDesc: '{count} tasks to handle',
    overviewSummaryMemosDesc: '{count} memos to organize',
    tasksHeaderSub: 'Schedule',
    tasksTotal: 'Total Tasks',
    tasksTodo: 'Needs Action',
    tasksCreateTitle: 'Create Task',
    tasksTitlePlaceholder: 'Task title',
    tasksStartPlaceholder: 'Start time',
    tasksEndPlaceholder: 'End time',
    tasksStatusTodo: 'Planned',
    tasksStatusProgress: 'In Progress',
    tasksStatusDone: 'Done',
    tasksEmpty: 'No schedules yet.',
    memoHeaderSub: 'Memo',
    memoCreateTitle: 'New Memo',
    memoTitlePlaceholder: 'Memo title',
    memoContentPlaceholder: 'Memo content',
    memoCreate: 'Create Memo',
    memoEmpty: 'No memos yet.',
    memoNoContent: 'No content',
    filesHeaderSub: 'Files',
    filesFilterAll: 'All',
    filesFilterImage: 'Image',
    filesFilterDocument: 'Document',
    filesFilterOther: 'Other',
    filesEmpty: 'No files yet.',
    calendarMonthSchedule: '{month} Schedule ({count})',
    calendarEmpty: 'No schedules this month',
    queuePending: '{count} pending sync item(s)',
    queueRetry: 'Retry now',
    queueFlushing: 'Retrying...',
  },
};

const I18nContext = createContext<I18nContextValue | null>(null);

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const [locale, setLocale] = useState<Locale>('ko');

  const value = useMemo<I18nContextValue>(
    () => ({
      locale,
      setLocale,
      t: (key: string, params?: Record<string, string | number>) => {
        const base = dict[locale][key] ?? key;
        if (!params) return base;
        return Object.entries(params).reduce((acc, [paramKey, value]) => {
          return acc.replaceAll(`{${paramKey}}`, String(value));
        }, base);
      },
    }),
    [locale]
  );

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error('useI18n must be used within I18nProvider');
  return ctx;
}
